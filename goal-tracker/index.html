<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="https://i.ibb.co/4wzJ2vTq/image.png">
    <title>Goal Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Confetti library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <style>
        /* Animaci√≥n del gatito bailando */
        @keyframes dance {
            0%, 100% { transform: translateY(0) rotate(0); }
            25% { transform: translateY(-20px) rotate(-5deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
            75% { transform: translateY(-15px) rotate(-5deg); }
        }
        
        .dancing-cat {
            animation: dance 1s ease-in-out infinite;
        }
        
        /* Estilos para el gatito */
        .cat-ear {
            position: absolute;
            width: 0;
            height: 0;
            border-style: solid;
        }
        
        .cat-ear-left {
            border-width: 0 15px 20px 15px;
            border-color: transparent transparent #FF6B6B transparent;
            top: -20px;
            left: 20px;
            transform: rotate(-20deg);
        }
        
        .cat-ear-right {
            border-width: 0 15px 20px 15px;
            border-color: transparent transparent #FF6B6B transparent;
            top: -20px;
            right: 20px;
            transform: rotate(20deg);
        }
        
        .cat-tail {
            position: absolute;
            width: 30px;
            height: 10px;
            background: linear-gradient(90deg, #FF6B6B, #FDD835);
            border-radius: 5px;
            bottom: 10px;
            right: -25px;
            transform-origin: left center;
            animation: tailWag 0.5s ease-in-out infinite alternate;
        }
        
        @keyframes tailWag {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(30deg); }
        }
        
        /* Modal de celebraci√≥n */
        .celebration-modal {
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        
        /* Efecto de brillo para categor√≠as completadas */
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px currentColor; }
            50% { box-shadow: 0 0 20px currentColor; }
        }
        
        .completed-glow {
            animation: glow 1.5s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { createClient } = supabase;

        // CAMBIA ESTOS VALORES POR LOS DE TU PROYECTO SUPABASE
        const supabaseUrl = 'https://zgohawnfwbhyuubgzhit.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inpnb2hhd25md2JoeXV1Ymd6aGl0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc2NjExNTQsImV4cCI6MjA4MzIzNzE1NH0.3AF50DVfjnXhlx_chrPFeVXtnhRvFPhreZFq30y1mSY';
        const supabaseClient = createClient(supabaseUrl, supabaseKey);

        // Colores LEGO por defecto para 4 categor√≠as
        const DEFAULT_LEGO_COLORS = [
            { name: 'Travel', color: '#FF6B6B', colorOpaque: '#FFB0B0', id: 'travel', hops: 5, hasDescription: false },
            { name: 'Read', color: '#FDD835', colorOpaque: '#F3E79B', id: 'read', hops: 10, hasDescription: false },
            { name: 'Gym', color: '#26C6DA', colorOpaque: '#8DD9E5', id: 'gym', hops: 100, hasDescription: false },
            { name: 'Money', color: '#4CAF50', colorOpaque: '#90C695', id: 'money', hops: 500, hasDescription: false }
        ];

        // Paleta de colores para hasta 10 categor√≠as
        const COLOR_PALETTE = [
            { color: '#FF6B6B', colorOpaque: '#FFB0B0' }, // Rojo LEGO
            { color: '#FDD835', colorOpaque: '#F3E79B' }, // Amarillo LEGO
            { color: '#26C6DA', colorOpaque: '#8DD9E5' }, // Azul claro LEGO
            { color: '#4CAF50', colorOpaque: '#90C695' }, // Verde LEGO
            { color: '#AB47BC', colorOpaque: '#C98DD1' }, // Morado
            { color: '#FFA726', colorOpaque: '#FFCD85' }, // Naranja
            { color: '#7E57C2', colorOpaque: '#B39DDB' }, // Violeta
            { color: '#26A69A', colorOpaque: '#80CBC4' }, // Verde azulado
            { color: '#EC407A', colorOpaque: '#F48FB1' }, // Rosa
            { color: '#5C6BC0', colorOpaque: '#9FA8DA' }  // Azul √≠ndigo
        ];

        const GoalTracker = () => {
          const [progress, setProgress] = useState({});
          const [categories, setCategories] = useState(DEFAULT_LEGO_COLORS);
          const [showModal, setShowModal] = useState(false);
          const [showLoginModal, setShowLoginModal] = useState(false);
          const [showInfoModal, setShowInfoModal] = useState(false);
          const [showConfigModal, setShowConfigModal] = useState(false);
          const [showCatAnimation, setShowCatAnimation] = useState(false);
          const [showFireworks, setShowFireworks] = useState(false);
          const [completedCategory, setCompletedCategory] = useState(null);
          const [showResetModal, setShowResetModal] = useState(false);
          const [isLoading, setIsLoading] = useState(true);
          const [error, setError] = useState(null);
          const [username, setUsername] = useState('');
          const [inputUsername, setInputUsername] = useState('');
          const [loginError, setLoginError] = useState('');
          const [isFirstTimeSetup, setIsFirstTimeSetup] = useState(false);
          const [tempCategories, setTempCategories] = useState([...DEFAULT_LEGO_COLORS]);
          const [recentlyCompleted, setRecentlyCompleted] = useState([]);
          const [isOverallCompleted, setIsOverallCompleted] = useState(false);
          const [showDescriptionModal, setShowDescriptionModal] = useState(false);
          const [selectedCategoryForDesc, setSelectedCategoryForDesc] = useState(null);
          const [descriptionInput, setDescriptionInput] = useState('');
          const [categoryEntries, setCategoryEntries] = useState({});
          const [showTrackingListModal, setShowTrackingListModal] = useState(false);

          const catAnimationRef = useRef(null);
          const fireworksRef = useRef(null);

          useEffect(() => {
            // Cargar usuario desde localStorage si existe
            const savedUsername = localStorage.getItem('goal_tracker_user');
            if (savedUsername) {
              setUsername(savedUsername);
              loadUserData(savedUsername);
            } else {
              // Usuario no logueado - mostrar vista por defecto
              setProgress({
                travel: 0,
                read: 0,
                gym: 0,
                money: 0
              });
              setCategories(DEFAULT_LEGO_COLORS);
              setIsLoading(false);
            }
          }, []);

          useEffect(() => {
            // Verificar si alguna categor√≠a se complet√≥ recientemente
            checkForCompletions();
          }, [progress, categories]);

          const checkForCompletions = () => {
            if (!username || Object.keys(progress).length === 0) return;

            // Verificar si se complet√≥ el 100% overall
            const totalProgress = getTotalProgress();
            const overallCompleted = totalProgress === 100;
            setIsOverallCompleted(overallCompleted);
            
            if (overallCompleted && !showFireworks) {
              triggerFireworks();
            }
            
            // Verificar categor√≠as individuales completadas
            categories.forEach(cat => {
              const currentProgress = progress[cat.id] || 0;
              const isCompleted = currentProgress >= cat.hops;
              
              if (isCompleted && !recentlyCompleted.includes(cat.id) && !overallCompleted) {
                // Si es una categor√≠a reci√©n completada (y no es el overall completo)
                setCompletedCategory(cat);
                setShowCatAnimation(true);
                setRecentlyCompleted(prev => [...prev, cat.id]);
                
                // Ocultar animaci√≥n del gatito despu√©s de 3 segundos
                setTimeout(() => {
                  setShowCatAnimation(false);
                }, 3000);
              }
            });
          };

          const triggerFireworks = () => {
            setShowFireworks(true);
            
            // Disparar confeti
            const duration = 3000;
            const animationEnd = Date.now() + duration;
            const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 1000 };
            
            function randomInRange(min, max) {
              return Math.random() * (max - min) + min;
            }
            
            const interval = setInterval(function() {
              const timeLeft = animationEnd - Date.now();
              
              if (timeLeft <= 0) {
                return clearInterval(interval);
              }
              
              const particleCount = 50 * (timeLeft / duration);
              
              // Fuegos artificiales desde abajo
              confetti({
                ...defaults,
                particleCount,
                origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 }
              });
              confetti({
                ...defaults,
                particleCount,
                origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 }
              });
              
              // Fuegos artificiales desde el centro
              confetti({
                particleCount: 10,
                spread: 70,
                origin: { y: 0.6 }
              });
              
            }, 250);
            
            // Ocultar animaci√≥n despu√©s de 5 segundos
            setTimeout(() => {
              setShowFireworks(false);
            }, 5000);
          };

          const handleLogin = async () => {
            const user = inputUsername.trim().toLowerCase();
            
            if (!user) {
              setLoginError('Por favor ingresa un usuario');
              return;
            }

            try {
              // Verificar si el usuario existe en la tabla 'users'
              const { data: userData, error: userError } = await supabaseClient
                .from('users')
                .select('*')
                .eq('username', user)
                .single();

              if (userError) {
                if (userError.code === 'PGRST116') {
                  setLoginError('Usuario no encontrado');
                } else {
                  throw userError;
                }
                return;
              }

              if (!userData || !userData.is_active) {
                setLoginError('Usuario no autorizado o inactivo');
                return;
              }

              // Guardar sesi√≥n
              localStorage.setItem('goal_tracker_user', user);
              setUsername(user);
              setShowLoginModal(false);
              setLoginError('');
              setInputUsername('');
              
              await loadUserData(user);
              
            } catch (err) {
              console.error('Error en login:', err);
              setLoginError('Error al iniciar sesi√≥n: ' + err.message);
            }
          };

          const loadUserData = async (user) => {
            try {
              setIsLoading(true);
              
              // Buscar configuraci√≥n del usuario en 'user_config'
              const { data: configData, error: configError } = await supabaseClient
                .from('user_config')
                .select('*')
                .eq('user_id', user)
                .single();

              if (configError && configError.code !== 'PGRST116') {
                throw configError;
              }

              if (!configData) {
                // Primera vez del usuario - crear categor√≠as iniciales con 4 items
                const initialCategories = [];
                for (let i = 0; i < 4; i++) {
                  initialCategories.push({
                    name: `Goal ${i + 1}`,
                    color: COLOR_PALETTE[i].color,
                    colorOpaque: COLOR_PALETTE[i].colorOpaque,
                    id: `goal_${i + 1}`,
                    hops: 10,
                    hasDescription: false
                  });
                }
                
                setTempCategories([...initialCategories]);
                setCategories([...initialCategories]);
                const initialProgress = {};
                initialCategories.forEach(cat => {
                  initialProgress[cat.id] = 0;
                });
                setProgress(initialProgress);
                
                setIsFirstTimeSetup(true);
                setIsLoading(false);
                return;
              }

              // Cargar categor√≠as personalizadas
              const userCategories = JSON.parse(configData.categories);
              setCategories(userCategories);

              // Cargar progreso desde 'progress'
              const { data: progressData, error: progressError } = await supabaseClient
                .from('progress')
                .select('*')
                .eq('user_id', user)
                .single();

              if (progressError && progressError.code !== 'PGRST116') {
                throw progressError;
              }

              if (progressData) {
                const userProgress = JSON.parse(progressData.progress_data);
                setProgress(userProgress);
                
                // Cargar entradas de categor√≠as si existen
                if (progressData.category_entries) {
                  setCategoryEntries(JSON.parse(progressData.category_entries));
                }
                
                // Verificar si ya estaba completado el overall
                const total = userCategories.reduce((sum, cat) => sum + cat.hops, 0);
                const current = userCategories.reduce((sum, cat) => sum + (userProgress[cat.id] || 0), 0);
                const overallCompleted = total > 0 ? Math.round((current / total) * 100) === 100 : false;
                setIsOverallCompleted(overallCompleted);
              } else {
                // Crear progreso inicial
                const initialProgress = {};
                userCategories.forEach(cat => {
                  initialProgress[cat.id] = 0;
                });
                setProgress(initialProgress);
                setCategoryEntries({});
              }

              setError(null);
            } catch (err) {
              console.error('Error:', err);
              setError('Error al cargar datos: ' + err.message);
            } finally {
              setIsLoading(false);
            }
          };

          const addNewCategory = () => {
            if (tempCategories.length >= 10) {
              setError('M√°ximo 10 categor√≠as permitidas');
              return;
            }
            
            const newIndex = tempCategories.length;
            const newCategory = {
              name: `Goal ${newIndex + 1}`,
              color: COLOR_PALETTE[newIndex % COLOR_PALETTE.length].color,
              colorOpaque: COLOR_PALETTE[newIndex % COLOR_PALETTE.length].colorOpaque,
              id: `goal_${newIndex + 1}`,
              hops: 10,
              hasDescription: false
            };
            
            setTempCategories([...tempCategories, newCategory]);
          };

          const removeCategory = (index) => {
            if (tempCategories.length <= 4) {
              setError('M√≠nimo 4 categor√≠as requeridas');
              return;
            }
            
            const updatedCategories = tempCategories.filter((_, i) => i !== index);
            setTempCategories(updatedCategories);
          };

          const saveConfig = async () => {
            try {
              // Validar que todos los campos est√©n llenos
              for (const cat of tempCategories) {
                if (!cat.name.trim()) {
                  setError('Todos los nombres son requeridos');
                  return;
                }
                if (!cat.hops || cat.hops < 1) {
                  setError('Los hops deben ser mayores a 0');
                  return;
                }
              }

              // Validar que haya al menos 4 categor√≠as
              if (tempCategories.length < 4) {
                setError('Se requieren al menos 4 categor√≠as');
                return;
              }

              // Primero verificar si ya existe configuraci√≥n para este usuario
              const { data: existingConfig } = await supabaseClient
                .from('user_config')
                .select('id')
                .eq('user_id', username)
                .single();

              let configResult;
              if (existingConfig) {
                // Actualizar configuraci√≥n existente
                configResult = await supabaseClient
                  .from('user_config')
                  .update({
                    categories: JSON.stringify(tempCategories),
                    updated_at: new Date().toISOString()
                  })
                  .eq('user_id', username);
              } else {
                // Crear nueva configuraci√≥n
                configResult = await supabaseClient
                  .from('user_config')
                  .insert({
                    user_id: username,
                    categories: JSON.stringify(tempCategories)
                  });
              }

              if (configResult.error) throw configResult.error;

              // Crear o actualizar progreso en 'progress' (siempre poner en 0)
              const newProgress = {};
              const newEntries = {};
              tempCategories.forEach(cat => {
                newProgress[cat.id] = 0;
                if (cat.hasDescription) {
                  newEntries[cat.id] = [];
                }
              });

              // Verificar si ya existe progreso para este usuario
              const { data: existingProgress } = await supabaseClient
                .from('progress')
                .select('id')
                .eq('user_id', username)
                .single();

              let progressResult;
              if (existingProgress) {
                // Actualizar progreso existente (resetear a 0)
                progressResult = await supabaseClient
                  .from('progress')
                  .update({
                    progress_data: JSON.stringify(newProgress),
                    category_entries: JSON.stringify(newEntries),
                    updated_at: new Date().toISOString()
                  })
                  .eq('user_id', username);
              } else {
                // Crear nuevo progreso
                progressResult = await supabaseClient
                  .from('progress')
                  .insert({
                    user_id: username,
                    progress_data: JSON.stringify(newProgress),
                    category_entries: JSON.stringify(newEntries)
                  });
              }

              if (progressResult.error) throw progressResult.error;

              setCategories(tempCategories);
              setProgress(newProgress);
              setCategoryEntries(newEntries);
              setShowConfigModal(false);
              setIsFirstTimeSetup(false);
              setIsOverallCompleted(false);
              setRecentlyCompleted([]);
              setError(null);
            } catch (err) {
              console.error('Error al guardar configuraci√≥n:', err);
              setError('Error al guardar: ' + err.message);
            }
          };

          const updateTempCategory = (index, field, value) => {
            const updated = [...tempCategories];
            if (field === 'hops') {
              updated[index][field] = parseInt(value) || 0;
            } else if (field === 'hasDescription') {
              updated[index][field] = value;
            } else {
              updated[index][field] = value;
            }
            setTempCategories(updated);
          };

          const saveProgress = async (newProgress, newEntries = null) => {
            try {
              // Primero verificar si ya existe un registro
              const { data: existingProgress, error: fetchError } = await supabaseClient
                .from('progress')
                .select('id')
                .eq('user_id', username)
                .single();

              if (fetchError && fetchError.code !== 'PGRST116') {
                throw fetchError;
              }

              const updateData = {
                progress_data: JSON.stringify(newProgress),
                updated_at: new Date().toISOString()
              };

              if (newEntries !== null) {
                updateData.category_entries = JSON.stringify(newEntries);
              }

              let result;
              if (existingProgress) {
                // Actualizar registro existente
                result = await supabaseClient
                  .from('progress')
                  .update(updateData)
                  .eq('user_id', username);
              } else {
                // Crear nuevo registro (para el primer guardado)
                result = await supabaseClient
                  .from('progress')
                  .insert({
                    user_id: username,
                    ...updateData
                  });
              }

              if (result.error) throw result.error;
              setError(null);
            } catch (err) {
              console.error('Error al guardar:', err);
              setError('Error al guardar: ' + err.message);
            }
          };

          const handleLogout = () => {
            // Solo remover el usuario del localStorage y resetear a vista por defecto
            localStorage.removeItem('goal_tracker_user');
            setUsername('');
            setInputUsername('');
            // Restaurar vista por defecto (sin afectar los datos guardados del usuario)
            setProgress({
              travel: 0,
              read: 0,
              gym: 0,
              money: 0
            });
            setCategories(DEFAULT_LEGO_COLORS);
            setShowInfoModal(false);
            setShowLoginModal(false);
            setShowCatAnimation(false);
            setShowFireworks(false);
            setShowResetModal(false);
            setRecentlyCompleted([]);
            setIsOverallCompleted(false);
            // NO resetear isFirstTimeSetup ya que es espec√≠fico del usuario
          };

          const handleAddClick = () => {
            if (!username) {
              setShowLoginModal(true);
            } else if (isFirstTimeSetup) {
              setShowConfigModal(true);
            } else if (isOverallCompleted) {
              // Si el overall est√° completado, mostrar modal para reiniciar
              setShowResetModal(true);
            } else {
              setShowModal(true);
            }
          };

          const handleResetGoals = () => {
            // Preparar las categor√≠as actuales para reconfiguraci√≥n
            setTempCategories([...categories]);
            setShowResetModal(false);
            setShowConfigModal(true);
          };

          const handleContinueCurrent = () => {
            // Solo cerrar el modal y continuar con las metas actuales
            setShowResetModal(false);
            setShowModal(true);
          };

          const handleCategorySelect = (categoryId) => {
            const category = categories.find(c => c.id === categoryId);
            
            // Si la categor√≠a tiene descripci√≥n habilitada, mostrar modal de descripci√≥n
            if (category.hasDescription) {
              setSelectedCategoryForDesc(category);
              setDescriptionInput('');
              setShowModal(false);
              setShowDescriptionModal(true);
            } else {
              // Incrementar directamente si no tiene descripci√≥n
              if (progress[categoryId] < category.hops) {
                const newProgress = {
                  ...progress,
                  [categoryId]: progress[categoryId] + 1
                };
                setProgress(newProgress);
                saveProgress(newProgress);
              }
              setShowModal(false);
            }
          };

          const handleSaveDescription = () => {
            if (!descriptionInput.trim() || !selectedCategoryForDesc) return;

            const categoryId = selectedCategoryForDesc.id;
            const category = categories.find(c => c.id === categoryId);

            // Incrementar progreso
            if (progress[categoryId] < category.hops) {
              const newProgress = {
                ...progress,
                [categoryId]: progress[categoryId] + 1
              };
              
              // Agregar entrada a la lista
              const newEntries = {
                ...categoryEntries,
                [categoryId]: [
                  ...(categoryEntries[categoryId] || []),
                  {
                    text: descriptionInput.trim(),
                    timestamp: new Date().toISOString()
                  }
                ]
              };

              setProgress(newProgress);
              setCategoryEntries(newEntries);
              saveProgress(newProgress, newEntries);
            }

            setShowDescriptionModal(false);
            setDescriptionInput('');
            setSelectedCategoryForDesc(null);
          };

          const drawPieSlice = () => {
            const totalSegments = categories.length;
            const anglePerSegment = 360 / totalSegments;
            const startAngle = -90;
            
            const createPath = (start, sweep) => {
              const startRad = (start * Math.PI) / 180;
              const endRad = ((start + sweep) * Math.PI) / 180;
              
              const x1 = 200 + 150 * Math.cos(startRad);
              const y1 = 200 + 150 * Math.sin(startRad);
              const x2 = 200 + 150 * Math.cos(endRad);
              const y2 = 200 + 150 * Math.sin(endRad);
              
              const largeArc = sweep > 180 ? 1 : 0;
              
              return `M 200 200 L ${x1} ${y1} A 150 150 0 ${largeArc} 1 ${x2} ${y2} Z`;
            };

            return (
              <svg width="400" height="400" viewBox="0 0 400 400" className="max-w-full h-auto">
                {categories.map((cat, idx) => {
                  const angle = startAngle + anglePerSegment * idx;
                  const progressAngle = (progress[cat.id] / cat.hops) * anglePerSegment;
                  const isCompleted = (progress[cat.id] || 0) >= cat.hops;
                  
                  return (
                    <g key={cat.id}>
                      <path
                        d={createPath(angle, anglePerSegment)}
                        fill={cat.colorOpaque}
                        stroke="white"
                        strokeWidth="3"
                      />
                      
                      {progress[cat.id] > 0 && (
                        <path
                          d={createPath(angle, progressAngle)}
                          fill={cat.color}
                          stroke="white"
                          strokeWidth="3"
                          className={isCompleted ? "completed-glow" : ""}
                          style={isCompleted ? {filter: "drop-shadow(0 0 8px currentColor)"} : {}}
                        />
                      )}
                    </g>
                  );
                })}
                
                <circle
                  cx="200"
                  cy="200"
                  r="70"
                  fill="white"
                  stroke="#E0E0E0"
                  strokeWidth="2"
                  className="cursor-pointer hover:fill-gray-50 transition-colors"
                  onClick={handleAddClick}
                />
                
                <text
                  x="200"
                  y="205"
                  textAnchor="middle"
                  fontSize="40"
                  fontWeight="600"
                  fill="#666"
                  className="pointer-events-none select-none"
                >
                  +
                </text>
                
                {/* Indicador de completado en el centro */}
                {isOverallCompleted && (
                  <g>
                    <circle
                      cx="200"
                      cy="200"
                      r="65"
                      fill="gold"
                      fillOpacity="0.2"
                      className="completed-glow"
                    />
                    <text
                      x="200"
                      y="210"
                      textAnchor="middle"
                      fontSize="16"
                      fontWeight="bold"
                      fill="#D4AF37"
                    >
                      100% üéâ
                    </text>
                  </g>
                )}
              </svg>
            );
          };

          const getTotalProgress = () => {
            const total = categories.reduce((sum, cat) => sum + cat.hops, 0);
            const current = categories.reduce((sum, cat) => sum + (progress[cat.id] || 0), 0);
            return total > 0 ? Math.round((current / total) * 100) : 0;
          };

          const renderDancingCat = () => {
            return (
              <div className="fixed inset-0 flex items-center justify-center pointer-events-none z-50">
                <div className="relative dancing-cat" ref={catAnimationRef}>
                  {/* Cuerpo del gatito */}
                  <div className="w-32 h-32 bg-gradient-to-br from-pink-300 to-red-400 rounded-full relative">
                    {/* Orejas */}
                    <div className="cat-ear cat-ear-left"></div>
                    <div className="cat-ear cat-ear-right"></div>
                    
                    {/* Ojos */}
                    <div className="absolute top-10 left-8 w-6 h-6 bg-white rounded-full">
                      <div className="absolute inset-1 w-4 h-4 bg-blue-500 rounded-full"></div>
                    </div>
                    <div className="absolute top-10 right-8 w-6 h-6 bg-white rounded-full">
                      <div className="absolute inset-1 w-4 h-4 bg-blue-500 rounded-full"></div>
                    </div>
                    
                    {/* Nariz */}
                    <div className="absolute top-16 left-1/2 transform -translate-x-1/2 w-4 h-3 bg-pink-500 rounded-full"></div>
                    
                    {/* Boca */}
                    <div className="absolute top-20 left-1/2 transform -translate-x-1/2 w-8 h-1 bg-pink-700 rounded-full"></div>
                    
                    {/* Bigotes */}
                    <div className="absolute top-16 left-4 w-8 h-0.5 bg-white transform rotate-12"></div>
                    <div className="absolute top-16 right-4 w-8 h-0.5 bg-white transform -rotate-12"></div>
                    <div className="absolute top-18 left-2 w-6 h-0.5 bg-white transform rotate-6"></div>
                    <div className="absolute top-18 right-2 w-6 h-0.5 bg-white transform -rotate-6"></div>
                    
                    {/* Cola */}
                    <div className="cat-tail"></div>
                  </div>
                  
                  {/* Mensaje */}
                  <div className="absolute -top-20 left-1/2 transform -translate-x-1/2 bg-white px-4 py-2 rounded-lg shadow-lg">
                    <div className="text-lg font-bold text-center text-purple-600">
                      ¬°Felicidades! üéâ
                    </div>
                    <div className="text-sm text-center text-gray-600">
                      Completaste: {completedCategory?.name}
                    </div>
                  </div>
                </div>
              </div>
            );
          };

          const renderCelebrationModal = () => {
            return (
              <div className="fixed inset-0 flex items-center justify-center z-50">
                {/* Fondo semitransparente */}
                <div className="absolute inset-0 bg-black bg-opacity-70"></div>
                
                {/* Modal de celebraci√≥n */}
                <div className="relative bg-gradient-to-br from-yellow-400 via-pink-500 to-purple-600 rounded-2xl p-8 max-w-md w-full mx-4 celebration-modal">
                  <div className="text-center">
                    <div className="text-5xl mb-4">üéäüéâüéä</div>
                    <h2 className="text-3xl font-bold text-white mb-4">¬°FELICIDADES!</h2>
                    <div className="text-xl text-white font-semibold mb-2">
                      ¬°LO LOGRASTE! üèÜ
                    </div>
                    <p className="text-white mb-6">
                      ¬°Completaste el 100% de todas tus metas! 
                      Eres incre√≠ble. ¬°Sigue as√≠!
                    </p>
                    <div className="text-sm text-white mb-6">
                      Ahora puedes reiniciar tus metas para un nuevo ciclo
                    </div>
                    <button
                      onClick={() => setShowFireworks(false)}
                      className="bg-white text-purple-600 font-bold py-3 px-8 rounded-full hover:bg-gray-100 transition-colors shadow-lg text-3xl"
                      title="¬°Gracias!"
                    >
                      ü•≥
                    </button>
                  </div>
                  
                  {/* Estrellas decorativas */}
                  <div className="absolute -top-4 -left-4 text-4xl">‚≠ê</div>
                  <div className="absolute -top-4 -right-4 text-4xl">‚≠ê</div>
                  <div className="absolute -bottom-4 -left-4 text-4xl">üåü</div>
                  <div className="absolute -bottom-4 -right-4 text-4xl">üåü</div>
                </div>
              </div>
            );
          };

          const renderResetModal = () => {
            return (
              <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                <div className="bg-white rounded-lg shadow-xl p-6 max-w-sm w-full">
                  <h2 className="text-xl font-bold mb-4 text-gray-800 text-center">üéä ¬°Felicidades! üéä</h2>
                  
                  <div className="text-center mb-6">
                    <div className="text-4xl mb-4">üèÜ</div>
                    <p className="text-gray-700 mb-4">
                      ¬°Has completado el 100% de todas tus metas!
                    </p>
                    <p className="text-gray-600 text-sm mb-6">
                      ¬øQu√© te gustar√≠a hacer ahora?
                    </p>
                  </div>
                  
                  <button
                    onClick={handleResetGoals}
                    className="w-full py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:opacity-90 transition-opacity mb-3 font-semibold text-2xl"
                    title="Establecer nuevas metas"
                  >
                    üÜï
                  </button>
                  
                  <button
                    onClick={handleContinueCurrent}
                    className="w-full py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:opacity-90 transition-opacity mb-3 font-semibold text-2xl"
                    title="Continuar con metas actuales"
                  >
                    ‚ñ∂Ô∏è
                  </button>
                  
                  <button
                    onClick={() => setShowResetModal(false)}
                    className="w-full py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors text-2xl"
                    title="Cancelar"
                  >
                    ‚úñÔ∏è
                  </button>
                </div>
              </div>
            );
          };

          if (isLoading) {
            return (
              <div className="min-h-screen bg-gray-100 flex items-center justify-center">
                <div className="text-gray-600">Cargando...</div>
              </div>
            );
          }

          return (
            <div className="min-h-screen bg-gray-100 flex items-center justify-center p-4 relative">
              {/* Animaci√≥n de fuegos artificiales (solo se activa cuando showFireworks es true) */}
              {showFireworks && renderCelebrationModal()}
              
              {/* Animaci√≥n del gatito (solo se activa cuando showCatAnimation es true) */}
              {showCatAnimation && renderDancingCat()}
              
              {/* Modal para reiniciar metas cuando overall est√° completado */}
              {showResetModal && renderResetModal()}
              
              <div className="bg-white rounded-lg shadow-lg p-8 max-w-md w-full relative">
                <h1 className="text-2xl font-bold text-center mb-6 text-gray-800">
                  Goal Tracker
                </h1>
                
                {error && (
                  <div className="mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded text-sm">
                    {error}
                  </div>
                )}
                
                <div className="flex justify-center mb-6">
                  {drawPieSlice()}
                </div>
                
                <div className="space-y-3">
                  <div className="flex items-center gap-3 pb-3 border-b-2 border-gray-300">
                    <span className="text-sm font-bold text-blue-600 w-20">
                      Overall
                    </span>
                    <div className="flex-1 bg-gray-200 rounded-full h-4 relative overflow-hidden">
                      <div
                        className="h-full rounded-full transition-all duration-300"
                        style={{
                          backgroundColor: '#2196F3',
                          width: `${getTotalProgress()}%`
                        }}
                      />
                    </div>
                    <span className="text-sm font-bold text-blue-600 w-12 text-right">
                      {getTotalProgress()}%
                    </span>
                  </div>
                  
                  {categories.map((cat) => {
                    const current = progress[cat.id] || 0;
                    const isCompleted = current >= cat.hops;
                    
                    return (
                      <div 
                        key={cat.id} 
                        className={`flex items-center gap-3 ${isCompleted ? 'completed-glow p-2 rounded-lg' : ''}`}
                        style={isCompleted ? {backgroundColor: `${cat.color}20`} : {}}
                      >
                        <span className="text-sm font-medium text-gray-700 w-20">
                          {cat.name}
                        </span>
                        <div className="flex-1 bg-gray-200 rounded-full h-4 relative overflow-hidden">
                          <div
                            className="h-full rounded-full transition-all duration-300"
                            style={{
                              backgroundColor: cat.color,
                              width: `${(current / cat.hops) * 100}%`
                            }}
                          />
                        </div>
                        <span className={`text-sm font-medium ${isCompleted ? 'font-bold' : 'text-gray-600'} w-12 text-right`}>
                          {current}/{cat.hops}
                          {isCompleted && <span className="ml-1">‚úì</span>}
                        </span>
                      </div>
                    );
                  })}
                </div>

                {username && (
                  <div
                    onClick={() => setShowInfoModal(true)}
                    className="absolute bottom-0 right-0 cursor-pointer hover:opacity-80 transition-opacity"
                    style={{
                      width: 0,
                      height: 0,
                      borderLeft: '30px solid transparent',
                      borderBottom: '30px solid #EF4444'
                    }}
                  />
                )}
              </div>

              {/* Modal de Login */}
              {showLoginModal && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                  <div className="bg-white rounded-lg shadow-xl p-6 max-w-sm w-full">
                    <h2 className="text-xl font-bold mb-4 text-gray-800">Ingresar Usuario</h2>
                    
                    <input
                      type="text"
                      placeholder="Usuario"
                      value={inputUsername}
                      onChange={(e) => setInputUsername(e.target.value)}
                      onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg mb-3 focus:outline-none focus:border-blue-500"
                      autoFocus
                    />
                    
                    {loginError && (
                      <div className="mb-3 p-2 bg-red-100 border border-red-400 text-red-700 rounded text-sm">
                        {loginError}
                      </div>
                    )}
                    
                    <button
                      onClick={handleLogin}
                      className="w-full py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors mb-2 text-2xl"
                      title="Entrar"
                    >
                      üîë
                    </button>
                    
                    <button
                      onClick={() => {
                        setShowLoginModal(false);
                        setLoginError('');
                        setInputUsername('');
                      }}
                      className="w-full py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors text-2xl"
                      title="Cancelar"
                    >
                      ‚úñÔ∏è
                    </button>
                  </div>
                </div>
              )}

              {/* Modal de Configuraci√≥n */}
              {showConfigModal && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto">
                  <div className="bg-white rounded-lg shadow-xl p-6 max-w-md w-full my-8">
                    <h2 className="text-xl font-bold mb-4 text-gray-800">
                      {isOverallCompleted ? 'üéâ ¬°Nuevas Metas! üéâ' : 'Configura tus Metas'}
                    </h2>
                    <p className="text-sm text-gray-600 mb-2">Categor√≠as: {tempCategories.length}/10 (M√≠nimo: 4)</p>
                    
                    {isOverallCompleted && (
                      <div className="mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                        <p className="text-sm text-yellow-800">
                          <span className="font-bold">¬°Felicidades por completar tu ciclo anterior!</span><br/>
                          Configura tus nuevas metas para comenzar un nuevo ciclo. Todos los contadores se reiniciar√°n a 0.
                        </p>
                      </div>
                    )}
                    
                    <div className="space-y-4 mb-6">
                      {tempCategories.map((cat, index) => (
                        <div key={cat.id} className="border border-gray-300 rounded-lg p-3 relative">
                          <div className="flex items-center gap-2 mb-2">
                            <div
                              className="w-6 h-6 rounded"
                              style={{ backgroundColor: cat.color }}
                            />
                            <input
                              type="text"
                              value={cat.name}
                              onChange={(e) => updateTempCategory(index, 'name', e.target.value)}
                              className="flex-1 px-2 py-1 border border-gray-300 rounded focus:outline-none focus:border-blue-500"
                              placeholder="Nombre"
                            />
                            {tempCategories.length > 4 && (
                              <button
                                onClick={() => removeCategory(index)}
                                className="w-8 h-8 flex items-center justify-center text-red-500 hover:text-red-700 text-xl"
                                title="Eliminar categor√≠a"
                              >
                                ‚úñÔ∏è
                              </button>
                            )}
                          </div>
                          <div className="flex items-center gap-2">
                            <label className="text-xl w-8" title="Hops">ü¶ò</label>
                            <input
                              type="number"
                              value={cat.hops}
                              onChange={(e) => updateTempCategory(index, 'hops', e.target.value)}
                              className="w-20 px-2 py-1 border border-gray-300 rounded focus:outline-none focus:border-blue-500"
                              min="1"
                            />
                            <label className="text-xl w-8 ml-2" title="Descripci√≥n">üìù</label>
                            <input
                              type="checkbox"
                              checked={cat.hasDescription || false}
                              onChange={(e) => updateTempCategory(index, 'hasDescription', e.target.checked)}
                              className="w-5 h-5 cursor-pointer"
                            />
                          </div>
                        </div>
                      ))}
                    </div>
                    
                    {tempCategories.length < 10 && (
                      <button
                        onClick={addNewCategory}
                        className="w-full py-2 mb-4 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-gray-400 hover:text-gray-800 transition-colors flex items-center justify-center gap-2 text-2xl"
                        title="Agregar nueva categor√≠a"
                      >
                        ‚ûï
                      </button>
                    )}
                    
                    <div className="flex gap-3">
                      <button
                        onClick={saveConfig}
                        className="flex-1 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-2xl"
                        title="Guardar configuraci√≥n"
                      >
                        üíæ
                      </button>
                      <button
                        onClick={() => {
                          if (tempCategories.length < 4) {
                            const newCategories = [];
                            for (let i = 0; i < 4; i++) {
                              if (i < tempCategories.length) {
                                newCategories.push({...tempCategories[i]});
                              } else {
                                newCategories.push({
                                  name: `Goal ${i + 1}`,
                                  color: COLOR_PALETTE[i].color,
                                  colorOpaque: COLOR_PALETTE[i].colorOpaque,
                                  id: `goal_${i + 1}`,
                                  hops: 10,
                                  hasDescription: false
                                });
                              }
                            }
                            setTempCategories(newCategories);
                          }
                          setShowConfigModal(false);
                        }}
                        className="flex-1 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors text-2xl"
                        title="Cancelar"
                      >
                        ‚úñÔ∏è
                    </button>
                    </div>
                  </div>
                </div>
              )}

              {/* Modal de Informaci√≥n */}
              {showInfoModal && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                  <div className="bg-white rounded-lg shadow-xl p-6 max-w-sm w-full">
                    <h2 className="text-xl font-bold mb-2 text-gray-800 text-center">Goal Tracker</h2>
                    <p className="text-sm text-gray-600 text-center mb-4">User: {username}</p>
                    <p className="text-sm text-gray-600 text-center mb-6">Developed by Carlos Galindo</p>
                    
                    <button
                      onClick={() => {
                        setTempCategories([...categories]);
                        setShowInfoModal(false);
                        setShowConfigModal(true);
                      }}
                      className="w-full py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors mb-2 text-2xl"
                      title="Reconfigurar Metas"
                    >
                      ‚öôÔ∏è
                    </button>

                    <button
                      onClick={() => {
                        setShowInfoModal(false);
                        setShowTrackingListModal(true);
                      }}
                      className="w-full py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors mb-2 text-2xl"
                      title="Tracking List"
                    >
                      üìã
                    </button>

                    <button
                      onClick={handleLogout}
                      className="w-full py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors mb-2 text-2xl"
                      title="Cerrar Sesi√≥n"
                    >
                      üö™
                    </button>
                    
                    <button
                      onClick={() => setShowInfoModal(false)}
                      className="w-full py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors text-2xl"
                      title="Cerrar"
                    >
                      ‚úñÔ∏è
                    </button>
                  </div>
                </div>
              )}

              {/* Modal de Categor√≠as */}
              {showModal && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                  <div className="bg-white rounded-lg shadow-xl p-6 max-w-xs w-full">
                    <div className="flex flex-col gap-3">
                      {/* Primera fila */}
                      <div className="flex gap-3 justify-center">
                        {categories.slice(0, 2).map((cat) => (
                          <button
                            key={cat.id}
                            onClick={() => handleCategorySelect(cat.id)}
                            className="w-24 h-24 rounded-2xl font-semibold text-white transition-transform hover:scale-105 active:scale-95 flex items-center justify-center text-center px-2"
                            style={{ backgroundColor: cat.color }}
                          >
                            {cat.name}
                          </button>
                        ))}
                      </div>
                      
                      {/* Segunda fila */}
                      <div className="flex gap-3 justify-center">
                        {categories.slice(2, 4).map((cat) => (
                          <button
                            key={cat.id}
                            onClick={() => handleCategorySelect(cat.id)}
                            className="w-24 h-24 rounded-2xl font-semibold text-white transition-transform hover:scale-105 active:scale-95 flex items-center justify-center text-center px-2"
                            style={{ backgroundColor: cat.color }}
                          >
                            {cat.name}
                          </button>
                        ))}
                      </div>
                      
                      {/* Filas adicionales si hay m√°s de 4 categor√≠as */}
                      {categories.length > 4 && (
                        <div className="flex gap-3 justify-center">
                          {categories.slice(4, 6).map((cat) => (
                            <button
                              key={cat.id}
                              onClick={() => handleCategorySelect(cat.id)}
                              className="w-24 h-24 rounded-2xl font-semibold text-white transition-transform hover:scale-105 active:scale-95 flex items-center justify-center text-center px-2"
                              style={{ backgroundColor: cat.color }}
                            >
                              {cat.name}
                            </button>
                          ))}
                        </div>
                      )}
                      
                      {/* M√°s filas si hay m√°s de 6 categor√≠as */}
                      {categories.length > 6 && (
                        <div className="flex gap-3 justify-center">
                          {categories.slice(6, 8).map((cat) => (
                            <button
                              key={cat.id}
                              onClick={() => handleCategorySelect(cat.id)}
                              className="w-24 h-24 rounded-2xl font-semibold text-white transition-transform hover:scale-105 active:scale-95 flex items-center justify-center text-center px-2"
                              style={{ backgroundColor: cat.color }}
                            >
                              {cat.name}
                            </button>
                          ))}
                        </div>
                      )}
                      
                      {/* √öltima fila para 9-10 categor√≠as */}
                      {categories.length > 8 && (
                        <div className="flex gap-3 justify-center">
                          {categories.slice(8, 10).map((cat) => (
                            <button
                              key={cat.id}
                              onClick={() => handleCategorySelect(cat.id)}
                              className="w-24 h-24 rounded-2xl font-semibold text-white transition-transform hover:scale-105 active:scale-95 flex items-center justify-center text-center px-2"
                              style={{ backgroundColor: cat.color }}
                            >
                              {cat.name}
                            </button>
                          ))}
                        </div>
                      )}
                    </div>
                    
                    <button
                      onClick={() => setShowModal(false)}
                      className="mt-6 w-full py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors text-2xl"
                      title="Cancelar"
                    >
                      ‚úñÔ∏è
                    </button>
                  </div>
                </div>
              )}

              {/* Modal de Descripci√≥n */}
              {showDescriptionModal && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                  <div className="bg-white rounded-lg shadow-xl p-6 max-w-sm w-full">
                    <h2 className="text-xl font-bold mb-4 text-gray-800 text-center">
                      üìù {selectedCategoryForDesc?.name}
                    </h2>
                    
                    <textarea
                      value={descriptionInput}
                      onChange={(e) => setDescriptionInput(e.target.value)}
                      onKeyPress={(e) => {
                        if (e.key === 'Enter' && !e.shiftKey) {
                          e.preventDefault();
                          handleSaveDescription();
                        }
                      }}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:border-blue-500 resize-none"
                      rows="4"
                      placeholder="Escribe aqu√≠..."
                      autoFocus
                    />
                    
                    <div className="flex gap-3">
                      <button
                        onClick={handleSaveDescription}
                        className="flex-1 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-2xl"
                        title="Guardar"
                        disabled={!descriptionInput.trim()}
                      >
                        ‚úÖ
                      </button>
                      
                      <button
                        onClick={() => {
                          setShowDescriptionModal(false);
                          setDescriptionInput('');
                          setSelectedCategoryForDesc(null);
                        }}
                        className="flex-1 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors text-2xl"
                        title="Cancelar"
                      >
                        ‚úñÔ∏è
                      </button>
                    </div>
                  </div>
                </div>
              )}

              {/* Modal de Tracking List */}
              {showTrackingListModal && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto">
                  <div className="bg-white rounded-lg shadow-xl p-6 max-w-2xl w-full my-8">
                    <h2 className="text-2xl font-bold mb-6 text-gray-800 text-center">
                      üìã Tracking List
                    </h2>
                    
                    <div className="space-y-6 mb-6 max-h-96 overflow-y-auto">
                      {categories
                        .filter(cat => cat.hasDescription && categoryEntries[cat.id]?.length > 0)
                        .map((cat) => (
                          <div key={cat.id} className="border-2 rounded-lg p-4" style={{ borderColor: cat.color }}>
                            <div className="flex items-center gap-2 mb-3">
                              <div
                                className="w-6 h-6 rounded"
                                style={{ backgroundColor: cat.color }}
                              />
                              <h3 className="text-lg font-bold text-gray-800">{cat.name}</h3>
                              <span className="text-sm text-gray-500 ml-auto">
                                ({categoryEntries[cat.id]?.length || 0} {categoryEntries[cat.id]?.length === 1 ? 'entry' : 'entries'})
                              </span>
                            </div>
                            
                            <div className="space-y-2">
                              {(categoryEntries[cat.id] || []).map((entry, idx) => (
                                <div key={idx} className="bg-gray-50 rounded p-3 border-l-4" style={{ borderLeftColor: cat.color }}>
                                  <p className="text-gray-800">{entry.text}</p>
                                  <p className="text-xs text-gray-500 mt-1">
                                    {new Date(entry.timestamp).toLocaleDateString('es-ES', {
                                      year: 'numeric',
                                      month: 'short',
                                      day: 'numeric',
                                      hour: '2-digit',
                                      minute: '2-digit'
                                    })}
                                  </p>
                                </div>
                              ))}
                            </div>
                          </div>
                        ))}
                      
                      {categories.filter(cat => cat.hasDescription && categoryEntries[cat.id]?.length > 0).length === 0 && (
                        <div className="text-center text-gray-500 py-8">
                          <p className="text-4xl mb-2">üì≠</p>
                          <p>No hay entradas registradas a√∫n</p>
                        </div>
                      )}
                    </div>
                    
                    <button
                      onClick={() => setShowTrackingListModal(false)}
                      className="w-full py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors text-2xl"
                      title="Cerrar"
                    >
                      ‚úñÔ∏è
                    </button>
                  </div>
                </div>
              )}
            </div>
          );
        };

        ReactDOM.render(<GoalTracker />, document.getElementById('root'));
    </script>
</body>
</html>
